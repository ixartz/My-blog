<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Changing / upgrading of a dedicated server by avoiding an unavailability | Ixartz’s technical blog</title> <meta name="generator" content="Jekyll v3.8.6"/> <meta property="og:title" content="Changing / upgrading of a dedicated server by avoiding an unavailability"/> <meta name="author" content="Ixartz"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="When you manage your own bare metal server, you need to update it. This guide is perfect for you if you need to upgrade your server without any unavailability."/> <meta property="og:description" content="When you manage your own bare metal server, you need to update it. This guide is perfect for you if you need to upgrade your server without any unavailability."/> <link rel="canonical" href="https://blog.ixartz.com/changing-upgrading-of-a-dedicated-server-by-avoiding-an-unavailability/"/> <meta property="og:url" content="https://blog.ixartz.com/changing-upgrading-of-a-dedicated-server-by-avoiding-an-unavailability/"/> <meta property="og:site_name" content="Ixartz’s technical blog"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2013-07-22T14:54:40+00:00"/> <script type="application/ld+json">
{"description":"When you manage your own bare metal server, you need to update it. This guide is perfect for you if you need to upgrade your server without any unavailability.","author":{"@type":"Person","name":"Ixartz"},"@type":"BlogPosting","url":"https://blog.ixartz.com/changing-upgrading-of-a-dedicated-server-by-avoiding-an-unavailability/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://blog.ixartz.com/assets/images/avatar.png"},"name":"Ixartz"},"headline":"Changing / upgrading of a dedicated server by avoiding an unavailability","dateModified":"2019-01-13T14:38:19+00:00","datePublished":"2013-07-22T14:54:40+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.ixartz.com/changing-upgrading-of-a-dedicated-server-by-avoiding-an-unavailability/"},"@context":"http://schema.org"}</script> <link rel="shortcut icon" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/style-fd671926271de12eaa76fa3cc6209199.css"> </head> <body> <nav class="main-nav"> <a href="/"> <span class="arrow">←</span>Home</a> <a href="/about/">About</a> <a class="cta" href="http://twitter.com/ixartz" target="_blank" rel="noopener noreferrer">Subscribe</a> </nav> <section class=" wrapper"> <article class="post"> <header> <h1>Changing / upgrading of a dedicated server by avoiding an unavailability</h1> <h2 class="headline">July 22, 2013</h2> </header> <section id="post-body"> <p>Lately, I spend my time setting up a new dedicated server after receiving a mail from my hosting company. Indeed, my contract will be interrupted. So, I have no choice to change my server. In order to have the least impact for my websites hosted on old server, the best solution is to use a virtual IP (some web hosting company call an IP fail-over).</p> <h2 id="set-up-a-virtual-ip-on-debian">Set up a virtual IP on Debian</h2> <p><em>I suppose that your new server is already set up</em></p> <p>A virtual IP is very useful in several cases. For example, it can be used in high availability network. Here, we use a virtual IP for moving one server to another in few seconds.</p> <p>Firstly, it is necessary to create a virtual network interface on the two servers. I will talk about how to do on Debian but you will find easily for other distributions on Internet.</p> <p>In your <em>/etc/network/interfaces</em> file, we need to add these two lines:</p> <figure class="highlight small"><pre><code class="language-sh" data-lang="sh">post-up /sbin/ifconfig eth0:1 <span class="o">(</span>new IP<span class="o">)</span> netmask 255.255.255.255 broadcast <span class="o">(</span>new IP<span class="o">)</span>
post-down /sbin/ifconfig eth0:1 down</code></pre></figure> <p>You need to do twice: one time with your old server and another time with your new server. So, <em>/etc/network/interfaces</em> file on your two servers should contain following:</p> <figure class="highlight small"><pre><code class="language-sh" data-lang="sh">auto eth0
iface eth0 inet static
address xxx.xxx.xxx.xxx
netmask 255.255.255.0
broadcast xxx.xxx.xxx.255
network xxx.xxx.xxx.0
gateway xxx.xxx.xxx.254
post-up /sbin/ifconfig eth0:0 <span class="o">(</span>new IP<span class="o">)</span> netmask 255.255.255.255 broadcast <span class="o">(</span>new IP<span class="o">)</span>
post-down /sbin/ifconfig eth0:0 down</code></pre></figure> <p>Then, you just have to restart the network interface:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">/etc/init.d/networking restart</code></pre></figure> <h2 id="deal-with-dns-servers">Deal with DNS servers</h2> <p>At the first time, the virtual IP must point toward the old server because domains still use the old IP. So, we need to point all website domains to the new virtual IP.</p> <p>For example, a record for a domain using Bind9 located at <em>/etc/bind/zones/mydomain.com.db</em>, you need to put your virtual IP at the line containing the current origin (the line containing ‘@’ character):</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="p">;</span>
<span class="p">;</span> BIND data file <span class="k">for </span><span class="nb">local </span>loopback interface
<span class="p">;</span>
<span class="nv">$TTL</span>    604800
@       IN      SOA     root.mydomain.com. <span class="o">(</span>
                              2         <span class="p">;</span> Serial
                         604800         <span class="p">;</span> Refresh
                          86400         <span class="p">;</span> Retry
                        2419200         <span class="p">;</span> Expire
                         604800 <span class="o">)</span>       <span class="p">;</span> Negative Cache TTL
<span class="p">;</span> ...
@       IN      A       <span class="o">(</span>your virtual IP<span class="o">)</span>
<span class="p">;</span> ...</code></pre></figure> <p>As usual, DNS propagation takes around 24/48 hours.</p> <p>After waiting 2 days, it is quite straightforward to change server without any issues or any unavailability. Indeed, we just have to point the virtual IP from the old server to the new server.</p> <p>Great! In few seconds, we can access to your website now hosted on your new server. Unfortunately, there is a very big issue regarding sending of mail from your new server. Especially, this issue is due to hotmail.com spam filter that considers our mails as spam. Frequently (not to say always), when you acquire a new IP, Hotmail treats your mails as unsafe. So, I suggest you to contact Hotmail to reinstate your virtual IP (it might last several days). So, do not hesitate to reinstate before moving to the new server.</p> <h2 id="sending-mails-with-a-virtual-ip">Sending mails with a virtual IP</h2> <p>Of course, I had to install a Mail Transfer Agent (MTA) and I chose Exim4 because I had already a little experience (I used Exim on my old server). This part is optional because if you does not keep your virtual IP. So, if you does not continue using your virtual IP, you need to change again your DNS server and you need to point all domains to your new server IP.</p> <h3 id="exim4-the-wrong-idea">Exim4, the wrong idea</h3> <p>I spent several nights to find how to send an email through an virtual IP with Exim. Unfortunately, I find anything to solve this problem.</p> <p><em>I will anyway describe installation and configuration steps</em></p> <p>Installing Exim4 is quite straightforward:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">apt-get <span class="nb">install </span>exim4</code></pre></figure> <p>To configure Exim4, it just enough to run the command and follow instructions:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">dpkg-reconfigure exim4-config</code></pre></figure> <p>Do not forget to restart your HTTP server if your websites need to send emails. For example, with an Apache server on Debian distribution, execute the following command:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">/etc/init.d/apache2 restart</code></pre></figure> <p>Now, you can send a mail but not from your virtual IP.</p> <h3 id="sendmail-the-messiah">Sendmail, the Messiah</h3> <p>Firstly, we need to install Sendmail using a package manager:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">apt-get <span class="nb">install </span>sendmail</code></pre></figure> <p>To locate where is the configuration file, type/copy-paste in your terminal:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">sendmail <span class="nt">-d0</span>.11</code></pre></figure> <p>And find the following line:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">Conf file:    <span class="o">(</span>file location<span class="o">)</span>     <span class="o">(</span>selected<span class="o">)</span></code></pre></figure> <p>For me, the configuration file is <em>/etc/mail/submit.cf</em>. So, in <em>submit.cf</em>, uncomment this line (remove <em>#</em>):</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#O ClientPortOptions=Family=inet, Address=0.0.0.0</span></code></pre></figure> <p>And, change <em>0.0.0.0</em> to your virtual IP.</p> <p>Restart Apache and Sendmail by executing these commands:</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">/etc/init.d/sendmail r
/etc/init.d/apache2 restart</code></pre></figure> <p>Voilà, every mail that will send from your new server will use your virtual IP.</p> <h2 id="conclusion">Conclusion</h2> <p>In conclusion, it is very easy to have almost no impact when upgrading or updating a server with a virtual IP. Nevertheless, it is necessary to prepare each steps. Especially, dealing with email services.</p> <p><em>PS: Hotmail spam detection is very picky! However, I have no choice to deal with because 40% of my members use Hotmail to sign up on my websites.</em></p> </section> </article> <footer id="post-meta" class="clearfix"> <a href="http://twitter.com/ixartz" target="_blank" rel="noopener noreferrer"> <img class="avatar" src="/assets/images/avatar.png" alt="@ixartz"> <div> <span class="dark">Ixartz</span> <span>Sharing Engineering Stuff</span> </div> </a> <section id="sharing"> <a class="twitter" href="https://twitter.com/intent/tweet?text=http://https://blog.ixartz.com/changing-upgrading-of-a-dedicated-server-by-avoiding-an-unavailability/%20-%20Changing%20/%20upgrading%20of%20a%20dedicated%20server%20by%20avoiding%20an%20unavailability%20by%20@ixartz" target="_blank" rel="noopener noreferrer"><span class="icon-twitter"> Tweet</span></a> </section> </footer> <div class="archive readmore"> <h3>Comments</h3> <section class="disqus"> <div id="disqus_thread"></div> <script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');

    s.src = '//ixartz.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="noopener noreferrer" target="_blank">comments powered by Disqus.</a> </noscript> </section> </div> </section> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-88747769-1', 'auto');
      ga('send', 'pageview');
    </script> </body> </html>